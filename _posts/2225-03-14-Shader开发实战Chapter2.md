---
title: "Shader开发实战Chapter2"
math: true
date: 2025-04-14 10:30:00 +0800
categories: [渲染管线]
tags: [shader]
---
## 使用纹理

如何仅仅使用顶点来表示图像，面对多彩的画面可能需要数百万个顶点，这意味着需要使用非常复杂的网格来显示图像，并且如果需要改变图像也会非常困难。所以我们使用可以逐片元变化的图像来提供颜色信息，这些图像就被称作纹理

纹理同纹理映射的过程应用于网格，该过程通常是获取2D纹理应用于3D网格的过程。为此，网格上的顶点被指定纹理坐标，片元着色器通过这些坐标来确定该点处纹理的颜色值。在纹理中查找给定坐标的颜色值的过程被称为纹理采样(texture sampling)

这本章中绘制的四边形是由两个三角形组成的因为，在集合计算中三角形运算更加便捷

## UV坐标

在纹理中将纹理的颜色位置分布在(0,1)的U轴和V轴上(就是XY轴)对应顶点继续映射

UV坐标在0~1之间并不意味着着色器只能使用0~1范围内的UV坐标，使用这个范围之外的坐标也是有效的，但是屏幕上的呈现效果取决于设置纹理的方式， 在超出0~1范围内的采样称为wrap mode(循环模式)，在默认of的情况下wrap mode模式为clamp即为重复着色最后坐标的颜色；将循环模式更改为wrap模式即可实现纹理循环

## 颜色数学计算

图像中的颜色通道为RGBA(rad,green,blue,alpha),任何一个颜射通道越接近1它的显示效果就越亮；我们可以对颜色通道进行运算来修改它的颜色显示效果，均匀的修改颜色的所有通道会导致该颜色均与的变量或者变暗，只修改颜色的部分通道会产生出新的颜色。但是无论如何进行加减颜色数值都不会大于1.0或者小于0.0。在颜色乘法中较深的颜色像素受到的乘法影响小于颜色较亮的像素

## 半透明于深度

在2D游戏中一般使用四边形来渲染内容，但是实际上我们呈现的图案并不都是一个个的矩形。要渲染非矩形的形状，2D游戏的着色器可以是四边形上的未使用的片元不可见

纹理的alpha通道测试可以在着色的时候将一部分不符合alpha值要求的片元丢弃(discard)，将大于alpha阈值的片元正常渲染；discard在GLSL中十分独特它会在片元着色器步骤完成之后直接终止流程该片元不会到达管线的下一阶段

在面对多层次对象的时候，默认情况下不会查看顶点或者片元的z值。为了根据位置关系正确放置其他物体后面的物体，需要我们创建一个深度缓冲区。深度缓冲区的所有计算都是在管线的片元处理阶段完成的

## Alpha混合的工作原理

alpha混合是在片元处理阶段完成的，管线在渲染的时候会在目标位置生成多个片元，当物体不透明的时候GPU通过深度计算确定物体在背景前面，可以安全地丢弃背景片元；当物体为半透明的时候写入目标位置的颜色是这两个片元的混合，这个混合是由一个混合方程控制的
$$
vec4\ finalColor=src+src.a+(1.0-src.a)*dst
$$
图形管线在每个网格上单独执行，因此绘制到屏幕的第一个网格将在下一个物体的片元着色器完成之前完成了其片元处理的过程。图形管线每次传递的结果都存储在所谓的后置缓冲(backbuffer)中，它指的是正在渲染的帧完全完成后将显示在屏幕上的图像，dst的值是指混合发生时后置缓冲的当前值；src指的是需要与当前存储在后置缓冲的值混合的新片元

