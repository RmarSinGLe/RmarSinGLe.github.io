---
title: "红黑树"
math: true
date: 2025-04-01 10:30:00 +0800
categories: [算法]
tags: [二叉树,平衡二叉树,]
---

## 红黑树

![Pasted image 20250514164442.png](assets/img/Pasted image 20250514164442.png)

### 作用

红黑树是一个自平衡的二叉搜索树，对数据的搜索删除和插入都有着很好的性质

### 时间复杂度

| 操作  | 平均        | 最差        |
| --- | --------- | --------- |
| 搜索  | O(log$n$) | O(log$n$) |
| 插入  | O(1)      | O(log$n$) |
| 删除  | O(1)      | O(log$n$) |

### 性质

要保证红黑树持续规范需要遵守以下五个原则

1. 红黑树的根节点是黑色的
2. 红色节点的两个子节点一定是黑色的
3. 所有叶子节点都是黑色的(叶子节点是NIL节点)
4. 任意一点到叶子的路径都含有相同的黑色节点都是相等的(黑高一致)
5. 节点是黑色或者红色的

### 查询

和二叉树的查询方式一样，小于根节点的往左查反之往右查

### 插入

红黑树的插入时重中之重，因为插入可能会影响红黑树的性质因此需要我们对插入之后出现的错误进行修复

红黑树规定插入节点一定是红色的，由此衍生以下7条规则(N，新节点；P，父亲节点；U，叔叔节点；G，祖父节点)

1. N是根节点
	违反规则1，修改措施将红色节点变为黑色
2. U是红色的，P是G的左孩子
	1. 将P和U染成黑色
	2. 将G染成红色
	3. current指向G继续向上检查是否违反规则
3. U是红色的，P是G的右孩子
	1. 1. 将P和U染成黑色
	2. 将G染成红色
	3. current指向G继续向上检查是否违反规则
4. U是黑色，P是G的左孩子，N是P的左孩子
	1. P染黑
	2. G染红
	3. 对G进行右旋
	4. current指向G继续向上检查是否违反规则
5. U是黑色，P是G的右孩子，N是P的右孩子
	 1. P染黑
	 2. G染红
	 3. 对P进行左旋
	 4. current指向G继续向上检查是否违反规则
6. U是黑色，P是G的左孩子，N是P的右孩子
	1. 先对P进行左旋，然后情况会变成情况4，使用情况4的步骤进行调整
	2. P染黑
	3. G染红
	4. 对G进行右旋
	5. current指向G继续向上检查是否违反规则
7. U是黑色，P是G的右孩子，NshiP的左孩子
	1. 先对P进行右旋，然后情况会变成情况5，使用情况4的步骤进行调整
	2. G染红
	3. 对P进行左旋
	4. current指向G继续向上检查是否违反规则

经过一次调整之后可能会导致后续上层的树违反红黑规则指导根节点为红色调整根节点为黑

### 删除

#### 第一步：删除节点

删除操作分为三种情况分别是：
- 没有子节点，Z 是叶子节点，直接删除
- 一个子节点，用 Z 的子节点替代 Z
- 两个子节点，找到 Z 的中序后继/中序前继（右子树中的最小节点，记为 Y），将 Y 的值复制到 Z，然后删除 Y
在红黑树中，删除操作最终会归结为删除一个叶子节点或只有一个子节点的节点（可能是原始的 Z 或其后继 Y）。我们将真正被移除的节点记为 X，后续的平衡调整将围绕 X 展开

#### 第二步：平衡调整

删除节点 X 后，红黑树的性质可能会被破坏，特别是当 X 是黑色节点时，会导致某些路径上的黑色节点数量减少，违反性质 5（黑色高度相等）。因此，需要额外的调整来恢复平衡

**红色节点 vs 黑色节点**

- **如果 X 是红色节点**：删除红色节点不会影响黑色高度，直接删除即可，无需调整。
- **如果 X 是黑色节点**：删除黑色节点会导致黑色高度减少，需要进行平衡调整。

为了处理黑色节点的删除，引入一个关键概念：**双黑（Double Black）**。当删除一个黑色节点 X 时，可以认为在 X 的位置留下了一个“双黑”标记，表示该路径的黑色高度减少了 1。调整的目标是消除这个双黑。

**双黑调整的情况**

双黑调整是红黑树删除的核心，依赖于双黑节点的兄弟节点（Sibling）及其子节点的颜色。假设双黑节点为 X，其父节点为 P，兄弟节点为 S，调整分为以下四种情况：

1. **情况 1：兄弟节点 S 是红色**
    - 操作：
        - 将 S 设为黑色。
        - 将 P 设为红色。
        - 对 P 进行左旋转（如果 S 是右子节点）或右旋转（如果 S 是左子节点）。
    - 效果：将问题转化为兄弟节点是黑色的情况，继续处理。
2. **情况 2：兄弟节点 S 是黑色，且 S 的两个子节点都是黑色**
    - 操作：
        - 将 S 设为红色。
        - 如果 P 是黑色，双黑向上传播到 P；如果 P 是红色，将 P 设为黑色，双黑消除。
    - 效果：要么消除双黑，要么将问题推到上一层。
3. **情况 3：兄弟节点 S 是黑色，S 的近子节点（靠近双黑节点的子节点）是红色，远子节点是黑色**
    - 操作：
        - 将 S 的近子节点设为黑色。
        - 将 S 设为红色。
        - 对 S 进行右旋转（如果双黑在左边）或左旋转（如果双黑在右边）。
    - 效果：转化为情况 4，继续处理。
4. **情况 4：兄弟节点 S 是黑色，且 S 的远子节点是红色**
    - 操作：
        - 将 S 的颜色设为 P 的颜色。
        - 将 P 设为黑色。
        - 将 S 的远子节点设为黑色。
        - 对 P 进行左旋转（如果双黑在左边）或右旋转（如果双黑在右边）。
    - 效果：双黑被消除，调整完成。

这些操作通过旋转和重新着色，确保黑色高度恢复，同时维持红黑树的性质。

